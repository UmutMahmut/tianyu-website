{% extends 'base.html' %}
{% block title %}{{ strings.publications }}{% endblock %}

{% block head_extra %}
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    /* è®©è¡¨æ ¼æŒ‰å›ºå®šå¸ƒå±€åˆ†åˆ—ï¼Œé¿å…è¢«æŸä¸€åˆ—é•¿æ–‡æœ¬æ‹–å® */
    #pub-table {
      table-layout: fixed;
      width: 100%;
    }

    /* ç¬¬ 2 åˆ—ï¼ˆæ ‡é¢˜ï¼‰å…è®¸æ¢è¡Œï¼Œå¿…è¦æ—¶å•è¯ä¸­é—´æ–­è¡Œ */
    #pub-table th:nth-child(2),
    #pub-table td:nth-child(2) {
      white-space: normal !important;
      word-break: break-word;
    }

    /* ç¬¬ 3 åˆ—ï¼ˆä½œè€…ï¼‰ä¹Ÿå…è®¸æ­£å¸¸æ¢è¡Œï¼Œé¿å…è¢« nowrap é”æ­» */
    #pub-table th:nth-child(3),
    #pub-table td:nth-child(3) {
      white-space: normal !important;
    }
  </style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
  <h1 class="text-2xl font-semibold mb-6">{{ strings.publications }}</h1>

  <table id="pub-table" class="display w-full text-sm">
    <thead>
      <tr>
        <th>#</th>
        <th>{{ strings['title_col'] if 'title_col' in strings else 'Title' }}</th>
        <th>{{ strings['authors'] if 'authors' in strings else 'Authors' }}</th>
        <th>{{ strings['year'] if 'year' in strings else 'Year' }}</th>
        <th>{{ strings['status'] }}</th>
        <th>PDF</th>
      </tr>
    </thead>
    <tbody>
      {% for paper in entries %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ paper.title }}</td>
        <td>
          {% set authors = paper.authors.split(' and ') %}
          {% if authors|length > 3 %}
            {{ authors[0] }}, {{ authors[1] }}, {{ authors[2] }}{% if get_lang() == 'zh' %} ç­‰äºº{% else %} et al.{% endif %}
          {% else %}
            {{ paper.authors }}
          {% endif %}
        </td>
        <td>{{ paper.year }}</td>
        <td>{{ strings[paper.status] if paper.status in strings else paper.status }}</td>
        <td>
          {% if paper.pdf and paper.pdf != '#' %}
            <a href="{{ paper.pdf }}" target="_blank" rel="noopener noreferrer" title="PDF">ğŸ“„</a>
          {% else %}-{% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script>
    $(function() {
      $('#pub-table').DataTable({
        paging: false,
        info: false,
        ordering: true,
        order: [[3, 'desc']], // é»˜è®¤æŒ‰å¹´ä»½é™åº
        language: {
          search: '{{ "æœç´¢" if get_lang() == "zh" else "Search" }}:',
          zeroRecords: '{{ "æœªæ‰¾åˆ°åŒ¹é…è®°å½•" if get_lang() == "zh" else "No matching records found" }}'
        },
        columnDefs: [
          { width: "6%",  targets: 0 },
          { width: "38%", targets: 1 },  // æ ‡é¢˜
          { width: "30%", targets: 2 },  // ä½œè€…
          { width: "10%", targets: 3 },
          { width: "10%", targets: 4 },
          { width: "6%",  targets: 5, orderable: false }
        ]
      });
    });
  </script>
{% endblock %}
