<!DOCTYPE html>
<html lang="{{ session.get('lang', 'zh') }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="dark light">
  <title>
    {% block title %}
      {% if strings is defined %}
        {{ strings.title }}
      {% else %}
        天语计划
      {% endif %}
    {% endblock %}
  </title>

  <!-- 全站统一样式：把 header/nav/main/footer 的样式从 inline 迁移到 design-system.css -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/design-system.css') }}">
  {% block head_extra %}{% endblock %}
</head>

<body>
  <header>
    <div class="header-left">
      <a href="/"><img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="Logo"></a>
      <span class="site-title">
        {% if strings is defined %}
          {{ strings.title }}
        {% else %}
          天语计划
        {% endif %}
      </span>
    </div>

    <nav>
      <ul>
        <!-- 首页 -->
        <li>
          <a href="/">{{ strings.home if strings is defined else '首页' }}</a>
        </li>

        <!-- 关于天语 -->
        <li class="has-sub">
          <span>
            {{ strings.about if strings is defined else '关于天语' }}
          </span>
          <ul>
            <li>
              <a href="/about">
                {{ strings.about_overview if strings is defined else '项目简介' }}
              </a>
            </li>
            <li>
              <a href="/about/lenghu">
                {{ strings.about_lenghu if strings is defined else '冷湖台址' }}
              </a>
            </li>
            <li>
              <a href="/about/optics">
                {{ strings.about_optics if strings is defined else '光机系统' }}
              </a>
            </li>
            <li>
              <a href="/about/control">
                {{ strings.about_control if strings is defined else '观测控制' }}
              </a>
            </li>
          </ul>
        </li>

        <!-- 实时气象 -->
        <li class="has-sub">
          <span>{{ strings.weather if strings is defined else '实时气象' }}</span>
          <ul>
            <li>
              <a href="/weather/yuanqi">
                {{ strings.yuanqi if strings is defined else '李所天文台' }}
              </a>
            </li>
            <li>
              <a href="/weather/lenghu">
                {{ strings.lenghu if strings is defined else '冷湖天文站' }}
              </a>
            </li>
          </ul>
        </li>

        <!-- 天语动态 -->
        <li class="has-sub">
          <span>{{ strings.news if strings is defined else '天语动态' }}</span>
          <ul>
            <li>
              <a href="/news/events">
                {{ strings.events if strings is defined else '重要事件' }}
              </a>
            </li>
            <li>
              <a href="/news/gallery">
                {{ strings.gallery if strings is defined else '画廊' }}
              </a>
            </li>
            <li>
              <a href="/news/outreach">
                {{ strings.education_outreach if strings is defined else '科教活动' }}
              </a>
            </li>
          </ul>
        </li>

        <!-- 科学研究 / 团队 -->
        <li>
          <a href="/research">
            {{ strings.research if strings is defined else '科学研究' }}
          </a>
        </li>
        <li>
          <a href="/team">
            {{ strings.team if strings is defined else '团队成员' }}
          </a>
        </li>

        <!-- 语言切换 -->
        <li>
          <a href="/lang/zh">中文</a> | <a href="/lang/en">EN</a>
        </li>
      </ul>
    </nav>
  </header>

  <main>
    <div class="main-content">
      {% block content %}{% endblock %}
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-grid">
        <!-- TDLI Logo -->
        <div class="footer-logo">
          <a href="https://tdli.sjtu.edu.cn/" target="_blank" rel="noopener">
            <img class="tdli-logo"
                 src="{{ url_for('static', filename='images/tdli/tdli_logo_blue.png') }}"
                 alt="Tsung-Dao Lee Institute (TDLI)">
          </a>
        </div>

        <!-- 联系我们（保留原信息） -->
        <div class="footer-section">
          <h3>{{ strings.contact_us if strings is defined else '联系我们' }}</h3>
          <ul role="list">
            <li>{{ strings.email if strings is defined else '邮箱' }}: tianyu_team@sjtu.edu.cn</li>
            <li>{{ strings.phone if strings is defined else '电话' }}: +86-21-34206000</li>
            <li>{{ strings.address if strings is defined else '上海市浦东新区李所路1号李政道研究所（201210）' }}</li>
          </ul>
        </div>

        <!-- 相关站点 -->
        <div class="footer-section footer-links">
          <h3>
            {% if session.get('lang') == 'en' %}
              Related Sites
            {% else %}
              相关站点
            {% endif %}
          </h3>
          <ul role="list">
            <li><a href="https://www.sjtu.edu.cn/" target="_blank" rel="noopener">上海交通大学</a></li>
            <li><a href="https://www.physics.sjtu.edu.cn/" target="_blank" rel="noopener">物理与天文学院</a></li>
            <li><a href="https://tdli.sjtu.edu.cn/" target="_blank" rel="noopener">李政道研究所</a></li>
            <li><a href="https://just.sjtu.edu.cn/CN/" target="_blank" rel="noopener">JUST</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <p class="icp-info">备案号：沪交ICP备20250305</p>
      </div>
    </div>
  </footer>

  <script>
    (function () {
      var hasSubs = document.querySelectorAll('nav li.has-sub');
      if (!hasSubs || !hasSubs.forEach) return;

      hasSubs.forEach(function (li) {
        var hideTimer;

        li.addEventListener('mouseenter', function () {
          clearTimeout(hideTimer);
          li.classList.add('open');
        });

        li.addEventListener('mouseleave', function () {
          hideTimer = setTimeout(function () {
            li.classList.remove('open');
          }, 250);
        });

        var label = li.querySelector('span');
        if (label) {
          label.setAttribute('tabindex', '0');

          label.addEventListener('click', function (e) {
            if (window.matchMedia && window.matchMedia('(hover: none)').matches) {
              e.preventDefault();
            }
            li.classList.toggle('open');
          });

          label.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              li.classList.toggle('open');
            }
          });
        }
      });
    })();
  </script>
</body>
</html>
